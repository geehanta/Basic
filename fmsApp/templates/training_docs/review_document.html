{% extends "base.html" %} {% load humanize %} {% load customfilter %} {% block pageContent %}

<!--Section: Content-->
 <!-- Main Application Container (Initially Hidden) -->
    <div id="app-container" class="container-fluid main-container" style="display: none;">
        <div class="header-section">
    <h2 class="m-0">
        {% if role == "reviewer" %}
            Training Documents Review Section
        {% elif role == "staff" %}
            Training Documents Upload Section
        {% else %}
            No Access
        {% endif %}
    </h2>
    <span class="version-tag">VERSION .05 FEB 2025</span>

    {% if role == "reviewer" %}
        <!-- Reviewer button -->
        <button id="review-document-btn" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#reviewModal">
            <i class="fas fa-check-circle me-1"></i> Review Document
        </button>
    {% elif role == "staff" %}
        <!-- Staff button -->
        <button id="upload-document-btn" class="btn btn-success upload-btn">
            <i class="fas fa-plus me-1"></i> Upload Document
        </button>
    {% endif %}
</div>
        
        <div class="bg-light p-2">
            <div class="badge bg-secondary">Documents uploaded: <span id="upload-count">1</span></div>
        </div>
        
        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs" id="documentTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="section1-tab" data-bs-toggle="tab" data-bs-target="#section1" type="button" role="tab">Section 1: Verification of Job Qualifications</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="section2-tab" data-bs-toggle="tab" data-bs-target="#section2" type="button" role="tab">Section 2 - Department Orientation Records</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="section3-tab" data-bs-toggle="tab" data-bs-target="#section3" type="button" role="tab">Section 3 - Education,Training,Competency</button>
            </li>
        </ul>
        
        <!-- Tab Content -->
        <div class="tab-content" id="documentTabsContent">
            <!-- Section 1 -->
            <div class="tab-pane fade show active" id="section1" role="tabpanel">
                <div class="row">
                    <div class="col-12 col-lg-4">
                        <div class="card mb-3">
                            <div class="card-header section-header">Section 1: Verification of Job Qualifications</div>
                            <ul class="doc-list">
                                <li class="doc-item">
                                    <span>1. Privacy Act Statement</span>
                                    <span class="status-badge verified">Verified</span>
                                </li>
                                <li class="doc-item">
                                    <span>2. Curriculum Vitae (CV)</span>
                                    <span class="status-badge verified">Verified</span>
                                </li>
                                <li class="doc-item">
                                    <span>3. Job Description</span>
                                    <span class="status-badge verified">Verified</span>
                                </li>
                                <li class="doc-item">
                                    <span>4. Additional Duty Appointment Orders - NA</span>
                                    <span class="status-badge pending">Pending</span>
                                </li>
                                <li class="doc-item">
                                    <span>5. CLIP Testing Qualification Form - NA</span>
                                    <span class="status-badge pending">Pending</span>
                                </li>
                                <li class="doc-item">
                                    <span>6. College or Technical School Diploma</span>
                                    <span class="status-badge pending">Pending</span>
                                </li>
                                <li class="doc-item">
                                    <span>7. Registration or Board Certification</span>
                                    <span class="status-badge pending">Pending</span>
                                </li>
                                <li class="doc-item">
                                    <span>8. Other Personell Documentation</span>
                                    <span class="status-badge pending">Pending</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-12 col-lg-8">
                        <!-- Document Table Section -->
                    <div class="card">
                        <div class="card-body">
                            <div class="search-container">
                                <div class="table-controls">
                                    <label>Show
                                        <select class="form-select form-select-sm">
                                            <option value="10">10</option>
                                            <option value="25" selected>25</option>
                                            <option value="50">50</option>
                                            <option value="100">100</option>
                                        </select>
                                        entries
                                    </label>
                                </div>
                                <div class="d-flex">
                                    <label class="me-2">Search:</label>
                                    <input type="search" class="form-control form-control-sm" id="docSearch">
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table id="documentTable" class="table table-bordered table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Title</th>
                                            <th>Uploaded By</th>
                                            <th>Date Uploaded</th>
                                            <th>Actions</th>  <!-- ✅ Must exist if you add buttons in tbody -->
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for doc in documents %}
                                            <tr>
                                                <td>{{ doc.id }}</td>
                                                <td>{{ doc.title }}</td>
                                                <td>{{ doc.uploaded_by }}</td>
                                                <td>{{ doc.date_uploaded }}</td>
                                                <td>
                                                    {% if role == "reviewer" %}
                                                        <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#reviewModal">
                                                            <i class="fas fa-check-circle"></i> Review
                                                        </button>
                                                    {% elif role == "staff" %}
                                                        {% if doc.id %}
                                                            <a href="{% url 'update_document' doc.id %}" class="btn btn-warning btn-sm">Update</a>
                                                            <a href="{% url 'delete_document' doc.id %}" class="btn btn-danger btn-sm">Delete</a>
                                                        {% else %}
                                                            <span class="text-muted">—</span>
                                                        {% endif %}
                                                    {% else %}
                                                        <span class="text-muted">—</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            
                        </div>
                    </div>
                        <!-- End Document Table Section -->
            
            <!-- Section 2 -->
            <div class="tab-pane fade" id="section2" role="tabpanel">
                <div class="row">
                    <div class="col-12 col-lg-4">
                        <div class="card mb-3">
                            <div class="card-header section-header">Section 2 - Department Orientation Records</div>
                            <ul class="doc-list">
                                <li class="doc-item">
                                    <span>1. Statement of Department Mission</span>
                                    <span class="status-badge pending">Pending</span>
                                </li>
                                <li class="doc-item">
                                    <span>2. Orientation Checklist</span>
                                    <span class="status-badge verified">Verified</span>
                                </li>
                                <li class="doc-item">
                                    <span>3. Initial SOP Training Checklist</span>
                                    <span class="status-badge pending">Pending</span>
                                </li>
                                <li class="doc-item">
                                    <span>4. Initial Competency Testing Results</span>
                                    <span class="status-badge pending">Pending</span>
                                </li>
                                <li class="doc-item">
                                    <span>5. Other Orientation Documentation</span>
                                    <span class="status-badge pending">Pending</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-12 col-lg-8">
                        <div class="card">
                            <div class="card-body">
                                <div class="search-container">
                                    <div class="table-controls">
                                        <label>Show
                                            <select class="form-select form-select-sm">
                                                <option value="10">10</option>
                                                <option value="25" selected>25</option>
                                                <option value="50">50</option>
                                                <option value="100">100</option>
                                            </select>
                                            entries
                                        </label>
                                    </div>
                                    <div class="d-flex">
                                        <label class="me-2">Search:</label>
                                        <input type="search" class="form-control form-control-sm">
                                    </div>
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover">
                                        <thead>
                                            <tr>
                                                <th>Section, Title <i class="fas fa-sort"></i></th>
                                                <th>Title, Description <i class="fas fa-sort"></i></th>
                                                <th>FileName <i class="fas fa-sort"></i></th>
                                                <th>Copy Link <i class="fas fa-sort"></i></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="4" class="text-center">No documents uploaded in this section</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="d-flex justify-content-between align-items-center mt-3">
                                    <div>Showing 0 to 0 of 0 entries</div>
                                    <nav>
                                        <ul class="pagination">
                                            <li class="page-item disabled"><a class="page-link" href="javascript:void(0)">Previous</a></li>
                                            <li class="page-item disabled"><a class="page-link" href="javascript:void(0)">Next</a></li>
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Section 3 -->
            <div class="tab-pane fade" id="section3" role="tabpanel">
                <div class="row">
                    <div class="col-12 col-lg-4">
                        <div class="card mb-3">
                            <div class="card-header section-header">Section 3 - Education,Training,Competency</div>
                            <ul class="doc-list">
                                <li class="doc-item">
                                    <span>1. Short Course Documentation</span>
                                    <span class="status-badge pending">Pending</span>
                                </li>
                                <li class="doc-item">
                                    <span>2. Routine Competency Testing Records</span>
                                    <span class="status-badge rejected">Rejected</span>
                                </li>
                                <li class="doc-item">
                                    <span>3. Annual SOP Training Documentation</span>
                                    <span class="status-badge pending">Pending</span>
                                </li>
                                <li class="doc-item">
                                    <span>4. Weekly Training Documentation</span>
                                    <span class="status-badge verified">Verified</span>
                                </li>
                                <li class="doc-item">
                                    <span>5. In-service Training Documentation</span>
                                    <span class="status-badge pending">Pending</span>
                                </li>
                                <li class="doc-item">
                                    <span>6. Publications</span>
                                    <span class="status-badge pending">Pending</span>
                                </li>
                                <li class="doc-item">
                                    <span>7. Other Training Documentation</span>
                                    <span class="status-badge pending">Pending</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-12 col-lg-8">
                        <div class="card">
                            <div class="card-body">
                                <div class="search-container">
                                    <div class="table-controls">
                                        <label>Show
                                            <select class="form-select form-select-sm">
                                                <option value="10">10</option>
                                                <option value="25" selected>25</option>
                                                <option value="50">50</option>
                                                <option value="100">100</option>
                                            </select>
                                            entries
                                        </label>
                                    </div>
                                    <div class="d-flex">
                                        <label class="me-2">Search:</label>
                                        <input type="search" class="form-control form-control-sm">
                                    </div>
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover">
                                        <thead>
                                            <tr>
                                                <th>Section, Title <i class="fas fa-sort"></i></th>
                                                <th>Title, Description <i class="fas fa-sort"></i></th>
                                                <th>FileName <i class="fas fa-sort"></i></th>
                                                <th>Copy Link <i class="fas fa-sort"></i></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="4" class="text-center">No documents uploaded in this section</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="d-flex justify-content-between align-items-center mt-3">
                                    <div>Showing 0 to 0 of 0 entries</div>
                                    <nav>
                                        <ul class="pagination">
                                            <li class="page-item disabled"><a class="page-link" href="javascript:void(0)">Previous</a></li>
                                            <li class="page-item disabled"><a class="page-link" href="javascript:void(0)">Next</a></li>
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Upload Document Modal -->
    <div class="modal fade" id="uploadModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Upload Document</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="uploadForm">
                        <div class="mb-3">
                            <label for="section" class="form-label">Section</label>
                            <select class="form-select" id="section" required>
                                <option value="" disabled selected>Select a section</option>
                                <option value="section1">Section 1: Verification of Job Qualifications</option>
                                <option value="section2">Section 2: Department Orientation Records</option>
                                <option value="section3">Section 3: Education,Training,Competency</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="documentType" class="form-label">Document Type</label>
                            <select class="form-select" id="documentType" required disabled>
                                <option value="" disabled selected>Select a document type</option>
                                <!-- Options will be populated based on selected section -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="description" class="form-label">Description (optional)</label>
                            <textarea class="form-control" id="description" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="documentFile" class="form-label">Document File</label>
                            <input class="form-control" type="file" id="documentFile" accept=".pdf,.docx,.xlsx">
                            <div class="form-text">Accepted formats: PDF, DOCX, XLSX</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveDocumentBtn">Upload Document</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Review Document Modal (for Reviewers) -->
    <div class="modal fade" id="reviewModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Review Document</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="reviewForm">
                        <div class="mb-3">
                            <label class="form-label">Document</label>
                            <p id="reviewDocumentName" class="form-control-static">Privacy Act Statement (2025-ORMdoping.pdf)</p>
                        </div>
                        <div class="mb-3">
                            <label for="verdict" class="form-label">Verdict</label>
                            <select class="form-select" id="verdict" required>
                                <option value="pending" selected>Pending Review</option>
                                <option value="approved">Approved</option>
                                <option value="expired">Expired</option>
                                <option value="invalid">Invalid</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="feedback" class="form-label">Feedback</label>
                            <textarea class="form-control" id="feedback" rows="4"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveReviewBtn">Submit Review</button>
                </div>
            </div>
        </div>
    </div>

</div> {% endblock pageContent %} {% block ScriptBlock %}

<!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <!-- DataTables -->
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
    
    <script id="app-script">
    // Document types by section
    const documentTypes = {
        section1: [
            { id: "privacy", name: "1. Privacy Act Statement" },
            { id: "cv", name: "2. Curriculum Vitae (CV)" },
            { id: "jobdesc", name: "3. Job Description" },
            { id: "dutyappt", name: "4. Additional Duty Appointment Orders" },
            { id: "clipform", name: "5. CLIP Testing Qualification Form" },
            { id: "diploma", name: "6. College or Technical School Diploma" },
            { id: "certification", name: "7. Registration or Board Certification" },
            { id: "otherperson", name: "8. Other Personnel Documentation" }
        ],
        section2: [
            { id: "deptmission", name: "1. Statement of Department Mission" },
            { id: "orientchecklist", name: "2. Orientation Checklist" },
            { id: "sopchecklist", name: "3. Initial SOP Training Checklist" },
            { id: "comptestresult", name: "4. Initial Competency Testing Results" },
            { id: "otherorient", name: "5. Other Orientation Documentation" }
        ],
        section3: [
            { id: "shortcourse", name: "1. Short Course Documentation" },
            { id: "routinecomp", name: "2. Routine Competency Testing Records" },
            { id: "annualsop", name: "3. Annual SOP Training Documentation" },
            { id: "weeklytraining", name: "4. Weekly Training Documentation" },
            { id: "inservice", name: "5. In-service Training Documentation" },
            { id: "publications", name: "6. Publications" },
            { id: "othertraining", name: "7. Other Training Documentation" }
        ]
    };

    // Current user role (will be set after login)
    let currentUserRole = null;
    
    $(document).ready(function() {
        // ✅ Initialize DataTable
        let table = $('#documentTable').DataTable({
            responsive: true,
            paging: true,
            searching: true,
            ordering: true,
            info: true,
            lengthChange: true,
            pageLength: 25,
            dom: 'lrtip' // keep length, table, info, pagination
        });

        // ✅ Hook custom search box
        $('#docSearch').on('keyup', function() {
            table.search(this.value).draw();
        });

        // Login button event
        $('#login-btn').on('click', function() {
            const username = $('#username').val();
            const password = $('#password').val();
            
            if (!username || !password) {
                alert('Please enter both username and password');
                return;
            }
            
            if (username.toLowerCase().includes('reviewer')) {
                currentUserRole = 'reviewer';
            } else {
                currentUserRole = 'staff';
            }
            
            $('#auth-container').hide();
            $('#app-container').show();
            
            updateUIForRole();
        });
        
        // Section select change handler
        $('#section').change(function() {
            const sectionId = $(this).val();
            const $documentTypeSelect = $('#documentType');
            
            $documentTypeSelect.empty().append('<option value="" disabled selected>Select a document type</option>');
            
            if (sectionId && documentTypes[sectionId]) {
                documentTypes[sectionId].forEach(function(docType) {
                    $documentTypeSelect.append(`<option value="${docType.id}">${docType.name}</option>`);
                });
                $documentTypeSelect.prop('disabled', false);
            } else {
                $documentTypeSelect.prop('disabled', true);
            }
        });
        
        // Upload document button click
        $('#upload-document-btn').on('click', function() {
            $('#uploadForm')[0].reset();
            $('#documentType').prop('disabled', true);
            $('#uploadModal').modal('show');
        });
        
        // Save document button click
        $('#saveDocumentBtn').on('click', function() {
            const form = $('#uploadForm')[0];
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const section = $('#section').val();
            const documentType = $('#documentType').val();
            const description = $('#description').val();
            const file = $('#documentFile')[0].files[0];
            
            if (!file) {
                alert('Please select a file to upload');
                return;
            }
            
            alert('Document uploaded successfully! It will be pending review.');
            
            $('#uploadModal').modal('hide');
            
            const currentCount = parseInt($('#upload-count').text());
            $('#upload-count').text(currentCount + 1);
        }); 
    });             
</script>

{% endblock ScriptBlock %}